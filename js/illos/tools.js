let frame = 0;
const startOffset = window.pageYOffset;
let lastMousePos = { x: null, y: null };
const degreesToRadians = (n) => (n * Math.PI) / 180;
const inside = (point, vs) => {
  // ray-casting algorithm based on
  // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html

  const x = point[0];

  const y = point[1];

  let inside = false;
  for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
    const xi = vs[i][0];
    const yi = vs[i][1];
    const xj = vs[j][0];
    const yj = vs[j][1];

    const intersect = yi > y != yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;
    if (intersect) inside = !inside;
  }

  return inside;
};
const mapRange = (value, inputMin, inputMax, outputMin, outputMax, clamp) => {
  if (Math.abs(inputMin - inputMax) < Number.EPSILON) {
    return outputMin;
  } else {
    const outVal =
      ((value - inputMin) / (inputMax - inputMin)) * (outputMax - outputMin) + outputMin;
    if (clamp) {
      if (outputMax < outputMin) {
        if (outVal < outputMax) outVal = outputMax;
        else if (outVal > outputMin) outVal = outputMin;
      } else {
        if (outVal > outputMax) outVal = outputMax;
        else if (outVal < outputMin) outVal = outputMin;
      }
    }
    return outVal;
  }
};

const canvas = document.querySelector("canvas");
const context = canvas.getContext("2d");
const rect = canvas.getBoundingClientRect();
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// prettier-ignore
const polylines = [
  [[202.30000000000004,125.79053344726562],[202.2014464892447,115.80204951092601],[201.2565527561368,105.8524817494137],[199.24784437766212,96.05291458077699],[195.93715388292188,86.64059816807422],[190.93811800779224,78.00063809594576],[183.89537319765662,70.95243602594128],[174.96220064084193,66.54846667537204],[165.10010500179672,65.20009262222084],[155.17305297851564,66.26951904296875],[145.88661062775648,69.86138197476976],[138.15098263341062,76.12759958279203],[132.49454290723955,84.35266275538015],[128.71554310259236,93.60370411527693],[126.33626824710518,103.306286258623],[124.94597386848474,113.19569796523429],[124.24633321333678,123.1673273023218],[124.01116855407601,133.17555691185407],[124.08870475436562,143.18181318198475],[124.61560238301757,153.15863932119683],[125.74825319088997,163.08394207170932],[127.6850620031357,172.90669440105557],[130.68969217161649,182.4340459293002],[135.13864262104036,191.37872463092208],[141.41977665908635,199.11532511844996],[149.62700663260185,204.75633476626388],[159.1602328651119,207.6786984066697],[169.12692922175628,208.11809402829527],[178.98615546897054,206.55623095510526],[188.07814932040637,202.48549984581913],[195.35721053268063,195.70979044258564],[200.20856530308959,186.99292736281495],[202.8859146480449,177.37386256613536],[203.96181791424755,167.45070398971438],[203.89155448237435,157.45457657886436],[207.1205472135684,151.2],[217.1385660773143,151.2],[227.13648106840847,151.2],[237.13835688829423,151.2],[247.1371746570716,151.2],[257.130846404811,151.2],[267.1207792372646,151.2],[276.8999999999999,151.4309089064598],[276.9,161.43589249700307],[276.59286630162967,171.43002345297717],[275.532224980912,181.37225330682722],[273.63951234623096,191.17650342251437],[270.82706797107824,200.77971193065022],[267.04255705475805,210.0316408254206],[262.2628674027612,218.8024800630772],[256.5071887059588,226.96752302623406],[249.84455395672848,234.4162748757933],[242.3825299367658,241.0736068412065],[234.26208239950793,246.8982462355974],[225.61325725875065,251.9002068283238],[216.5368581544011,256.12300253269984],[207.17559778146676,259.5994971890366],[197.56626035637453,262.40463210882876],[187.8240731423386,264.58184399972174],[177.94507105424998,266.19772526593874],[168.00899927681309,267.2934437685995],[158.03073384805083,267.9148914304998],[148.0315207846826,268.0987251971193],[138.02774012993524,267.8688716828461],[128.0614684986512,267.22617675610917],[118.12085519970658,266.13446529284244],[108.24413136853504,264.5564447774538],[98.47241585877835,262.45351976706024],[88.8369465078227,259.78175104642287],[79.39918144655965,256.50241111879734],[70.19824904218919,252.56727214191926],[61.323479106553165,247.94873835571033],[52.85943911202392,242.6272443198382],[44.89437497266377,236.59969482059137],[37.49773614828937,229.8666116876384],[30.770328673813466,222.4856932025284],[24.75867873158149,214.4994810916125],[19.5137781835976,205.99722174914785],[15.03994394863239,197.0429491255296],[11.342919856724437,187.74825459122314],[8.39518923322314,178.20219679906074],[6.149192700700109,168.45897105595742],[4.560124285870369,158.60128518161235],[3.5702110669011975,148.63765363390254],[3.1325270086033927,138.64839237659962],[3.202384393035186,128.65048636858623],[3.822903953549394,118.6845806273137],[5.031867556925864,108.74901742320507],[6.851033009571802,98.92343908151778],[9.310191525616393,89.22451850253564],[12.427546096425795,79.72287197729165],[16.219645012652812,70.47730117591377],[20.699339962604974,61.54758277854671],[25.875766581727838,52.99413666341898],[31.739560889970562,44.896369493615566],[38.27980752250441,37.31927168028487],[45.44360973783423,30.355366111234254],[53.19867692992866,24.05128249485606],[61.486555852741006,18.459663479030134],[70.23816425610566,13.619103608024307],[79.37464718249957,9.5530050444675],[88.80832198691988,6.2687002284288615],[98.48211451216632,3.7484481263073124],[108.32553471778195,1.9703163381844662],[118.26609762640437,0.902798152784817],[128.25858746107897,0.5047966006892238],[138.24251716353322,0.7351838209229754],[148.20586523705424,1.70331767036987],[158.01442420998504,3.6386388631741284],[167.5004098036225,6.7625627129542405],[176.4533192931718,11.192950664172532],[184.68573289179915,16.84726645300689],[192.1584119001418,23.493845221863012],[198.93494849314538,30.840968669588253],[205.1544130450653,38.65845344512199],[207.2320758946473,34.58299735793843],[207.42899072503207,24.56847169836983],[207.62561668578996,14.568637122679498],[208.92466269694265,5.699999999999997],[218.91788497786618,5.699999999999996],[228.91987018353316,5.699999999999995],[238.9234800610691,5.699999999999996],[248.92010029499286,5.699999999999996],[258.91781584724663,5.699999999999996],[268.9184907020709,5.699999999999996],[277.59999999999997,7.02823795790318],[277.59999999999997,17.025745334450033],[277.59999999999997,27.01580570323021],[277.59999999999997,37.01963615480344],[277.59999999999997,47.010595546738834],[277.59999999999997,57.02514082446868],[277.59999999999997,67.02539082563888],[277.59999999999997,77.01566844390071],[277.59999999999997,87.01426698889989],[277.59999999999997,97.01396691363806],[277.59999999999997,107.01787909089506],[277.59999999999997,117.01741879049223],[276.3867177495733,125.79999999999997],[266.3878315778827,125.79999999999998],[256.374186805007,125.79999999999998],[246.37463024563618,125.79999999999998],[236.36997589881065,125.79999999999998],[226.3842470844043,125.79999999999998],[216.37502075675877,125.79999999999998],[206.3751538257813,125.79999999999998]],
  [[570.9940766850475,267.9999999105932],[561.0015301029702,267.7227911469643],[551.0520347514539,266.78784751221536],[541.2076580766428,264.9951515504159],[531.6578125,262.1],[522.6363634505673,257.81564660640436],[514.5549878432997,251.9581201441586],[507.8114998345336,244.5991923057474],[502.5703900906401,236.0823834331124],[498.71952364369497,226.86915324693547],[495.964830833771,217.25142595311627],[494.03315732851604,207.44399491989753],[492.69540722115926,197.54727950999512],[491.77792938954224,187.5791384072043],[491.1549388885498,177.61007270812988],[489.88731704354285,167.69671868681908],[485.4886855829507,158.86176054049284],[476.79887360818685,154.11784109342844],[466.94680196158595,152.55220746826382],[461.8,157.25514069907368],[461.79999999999995,167.24059899360873],[461.8,177.25193207956036],[461.79999999999995,187.24085235595703],[461.8,197.24422673466614],[470.0545800507069,199],[480.04306240305306,199],[483.8,205.25307552458253],[483.8,215.24637387263647],[483.8,225.2460121029988],[483.79999999999995,235.23738275568468],[483.8,245.23916471122357],[483.8,255.2539446813753],[481.8582794977818,263.3],[471.85153946913783,263.29999999999995],[461.8587746917445,263.3],[451.84891046474803,263.3],[441.85547512756676,263.3],[431.8627715978364,263.3],[421.85554775515266,263.3],[411.8610798958689,263.3],[401.8460309672344,263.3],[391.8467914890964,263.3],[381.8573980121408,263.3],[371.8523937072132,263.3],[361.86112607493413,263.3],[351.86344838791405,263.3],[341.8537729412317,263.3],[331.8548097131308,263.3],[322.2,262.9540484547615],[322.2,252.95124388938711],[322.2,242.955078125],[322.2,232.96229262762063],[322.20000000000005,222.95437308906003],[322.2,212.95214234590532],[322.2,202.94956217913423],[328.2514626352116,199],[338.2491099167848,199],[348.25141601562495,199],[350.9,191.64868483556782],[350.9,181.6492800201464],[350.9,171.65644657306038],[350.9,161.6589879982639],[350.9,151.64268626128322],[350.9,141.65462621826373],[350.9,131.64695043861866],[350.9,121.6493020914022],[350.9,111.65717440881417],[350.9,101.64883907863623],[350.9,91.66092142660054],[350.9,81.65743787027895],[350.9,71.65869197552092],[342.94559033352414,69.6],[332.94645146781113,69.6],[322.96155471801757,69.6],[322,60.54917778857052],[322,50.54953160174191],[322,40.549399009346956],[322,30.55025279931723],[322,20.544565063342446],[322,10.54218055903911],[327.05258427225056,5.599999999999994],[337.052815036488,5.599999999999995],[347.0556093109706,5.599999999999995],[357.0459474114177,5.599999999999994],[367.04974847480526,5.599999999999994],[377.0464047254219,5.599999999999994],[387.0545086526613,5.599999999999993],[397.0501741181339,5.599999999999994],[407.05532906024575,5.599999999999995],[417.04808432591426,5.599999999999995],[427.05287699265875,5.599999999999994],[437.0427435113438,5.599999999999994],[447.051852885083,5.599999999999994],[457.04193908429806,5.599999999999994],[467.0528022258368,5.599999999999994],[477.0505114731044,5.599999999999994],[487.05630516044914,5.599999999999994],[497.04024296519924,5.599999999999994],[507.04985174834724,5.599999999999994],[517.0417165286839,5.6147683568298765],[527.0379829462369,5.9978198412687505],[536.9975211101532,6.9477845215607825],[546.8713173992933,8.544317633658643],[556.5784893917416,10.884654784972549],[566.0457082453946,14.098846078223682],[575.1085924591328,18.32523383852658],[583.5264969245022,23.685480609240763],[591.0425487995149,30.283152055740352],[597.3083639670064,38.052901069703694],[602.1014607435078,46.825306416126836],[605.3314655038688,56.27642249407217],[607.0988641244754,66.10760818086874],[607.5980141691616,76.07599837910675],[606.8810953721126,86.05316855663295],[604.7010675682379,95.80586360303278],[600.863472436648,105.01015701238066],[595.3150249986343,113.31115251423034],[588.2396239466631,120.371370084511],[580.0069420701169,126.02134430212027],[570.9871009062045,130.2997925588861],[561.4652777535026,133.34652765037026],[551.6567094325161,135.31737420916033],[541.7178217953187,136.35713508201297],[546.0090751327574,137.50371005237102],[555.8699485305813,139.18524298495612],[565.4917708873749,141.8313241958618],[574.6151476520681,145.9133018985216],[583.047087122139,151.26948111779058],[590.6686899566673,157.72247151968767],[596.825626934842,165.58695403314346],[601.2500631026923,174.54112595394258],[604.0155781107795,184.13116087899982],[605.5136530409567,194.00598620446402],[606.5791855002753,203.957384408731],[612.5275469437241,207.06835526376963],[615.906047976017,197.82123752832413],[616.332527256012,187.84035959243775],[621.1518004229292,182.9],[631.1607862664387,182.89999999999998],[637.9567980125764,186.05705385480107],[637.1904089701711,196.02452250981005],[635.2873003591667,205.84427901232849],[632.0060761263928,215.26975949812476],[627.1373923076433,223.98082720696692],[620.6426419384777,231.55773822292687],[612.7339830775643,237.66314556134603],[603.8341857845153,242.1743417147649],[594.3180366002387,245.2241038241118],[584.4749991344797,247.03163044249087],[574.5129395405709,247.82186511150957],[570.2725937219802,253.3791338118026],[570.7693241816014,263.3634160501882],[466.0483219146729,68],[462.2,74.15626869536936],[462.2,84.16324314454687],[462.2,94.149768428877],[462.20000000000005,104.15784000582062],[462.2,114.1537571400404],[469.36069132089614,117],[479.34740517064927,116.68820168375969],[489.1471246778965,114.84272027015686],[497.21197746290125,109.19262072974816],[500.87893309863284,99.98561178520322],[501.4726080332883,90.01990480192471],[500.0944852136075,80.14759316053241],[494.62517573237415,71.99845960587264],[485.2597354683094,68.73395744513255],[475.3000080180354,68.12164193403441]],
  [[261.7963012650613,396.3055114835498],[256.2282350420952,404.60855356156827],[250.67339800130577,412.9075231914874],[245.1132068768144,421.2355201620609],[239.56982230118012,429.56470651797133],[234.05044923026583,437.8894784495293],[228.54002938315682,446.2379556876018],[223.0532095855102,454.5935444395524],[217.58991084739102,462.962045837607],[212.14303502802215,471.36043423440935],[206.72760298571086,479.7719363427081],[201.60000000000002,488.279196035862],[201.60000000000002,498.2692281568336],[201.60000000000002,508.2752652586205],[201.60000000000002,518.268690779063],[204.17001640384552,525.7],[214.16767156233547,525.7],[224.17436903100463,525.7],[227.3,532.5659871796233],[227.3,542.5730597124523],[227.29999999999998,552.5731594073674],[227.3,562.5678233192914],[227.3,572.5783004432772],[227.3,582.5611575296149],[224.73856717110613,590],[214.733660477167,590],[204.7228910291313,590],[194.73136345675113,590],[184.7358498583606,590],[174.72183920753815,590],[164.73631078234104,590],[154.7333900454499,590],[144.73660226729118,590],[134.72439215934065,590],[124.7377366564477,590],[114.72808968524652,590],[104.73562982934601,590],[94.73607345659622,590],[84.72950992661646,590],[74.72937673628331,590],[66.30000000000003,588.426520444383],[66.3,578.4301862729714],[66.30000000000001,568.4325333932095],[66.30000000000001,558.4386548417766],[66.30000000000001,548.4376336325164],[66.30000000000001,538.4228155817284],[66.30000000000001,528.4218208318576],[73.57868575791363,525.7],[83.56706524605397,525.7],[92,524.1244129667059],[92,514.1257683465258],[92,504.1243819507538],[91.42241363203212,494.3031001848097],[85.98051802599184,485.91252732495946],[80.49584105660725,477.5475912123913],[74.98087185386976,469.2049853550227],[69.44799284543842,460.8814315062948],[63.90143763566448,452.5616230245607],[58.35339633410331,444.2423331161146],[52.808047593338046,435.9082705928465],[47.285677105843206,427.56825114997196],[41.79852805849987,419.2190339439045],[36.343180006873446,410.8331553290526],[30.940185546875,402.41936035156255],[24.362196445465088,396.20000000000005],[14.370891571044922,396.2000000000001],[4.3533275201916695,396.20000000000005],[0.5,390.0585053133284],[0.5,380.05469221677345],[0.5,370.0711613708409],[0.5,360.07190888511553],[0.5,350.0572694783798],[0.5,340.07151046376686],[2.7396151141583687,332.30000000000007],[12.73665892345125,332.3000000000001],[22.729222809779458,332.30000000000007],[32.73686156340409,332.30000000000007],[42.74718073200528,332.30000000000007],[52.748152528805434,332.30000000000007],[62.728342714314934,332.30000000000007],[72.73379390515942,332.30000000000007],[82.74152217691335,332.3],[92.74491521375894,332.30000000000007],[102.73510903994028,332.30000000000007],[112.7372326377785,332.30000000000007],[122.74715649920981,332.30000000000007],[132.7297493321821,332.30000000000007],[142.735404257357,332.30000000000007],[152.74808786821086,332.30000000000007],[162.2,332.8340605974198],[162.2,342.83244329988963],[162.2,352.8361239518971],[162.2,362.8473189204932],[162.2,372.83217315673835],[162.2,382.8444947034121],[162.2,392.8363898426295],[155.6692199707031,396.3000000000001],[145.66580446511506,396.30000000000007],[139.72645663300062,398.5134077799275],[145.12176318510902,406.92895950225653],[150.46387364331167,415.39075562895744],[155.70906200150492,423.9050084290328],[160.80097462218254,432.50590512361384],[165.60067602309863,441.2803157666466],[170.40405387878417,436.54201774597175],[175.71933605133526,428.0779945208968],[181.31392806394723,419.7893003880862],[187.00977801576954,411.577541204996],[192.65010219294345,403.3243915811531],[195.55300594605507,396.30000000000007],[185.55930517804808,396.3],[175.561524251895,396.30000000000007],[171.8,390.06149774901576],[171.79999999999998,380.0673627138139],[171.8,370.0609938848765],[171.79999999999995,360.0688575033099],[171.79999999999998,350.0638144101948],[171.8,340.05175802409656],[174.03501614485867,332.30000000000007],[184.04867980070412,332.30000000000007],[194.04030106721328,332.30000000000007],[204.04717803917518,332.30000000000007],[214.0434335932332,332.30000000000007],[224.04455283969799,332.30000000000007],[234.03645009771571,332.30000000000007],[244.0476541519165,332.3000000000001],[254.03814014731907,332.30000000000007],[264.03558722211966,332.30000000000007],[274.04576505742153,332.30000000000007],[284.034811388189,332.30000000000007],[294.0491145849228,332.30000000000007],[296,340.34084074497235],[296,350.34053179919727],[296,360.3480531323701],[296,370.3379509422929],[296,380.3357899200172],[296,390.3365067720414],[291.95939734936695,396.3000000000001],[281.9661881327163,396.30000000000007],[271.95697196891416,396.30000000000007],[261.9524782180786,396.3]],
  [[536.7974340677262,489.2999817371368],[526.8011495356274,489.228833804524],[516.8079433067294,489.1577077815426],[506.8078166183084,489.0865325026214],[496.7988106482837,489.01529402596645],[486.8021054700482,488.944143099431],[480.6,492.6996404647827],[480.5999999999999,502.7076611757279],[480.5999999999999,512.6998079936952],[480.59999999999997,522.7041045848281],[487.60291539542374,525.7],[497.59744440181527,525.7],[507.59945838106205,525.7],[517.5932603836059,525.7],[517.5999999999999,535.6939452229562],[517.5999999999999,545.6924549460412],[517.5999999999999,555.7086001563148],[517.5999999999999,565.690927040577],[517.5999999999999,575.6898193684174],[517.5999999999999,585.7063079182292],[511.89056144610504,590],[501.9018480023601,590],[491.9060358567162,590],[481.90333733129364,590],[471.90203862520093,590],[461.8949433171361,590],[451.899606721879,590],[441.8995501654603,590],[431.8996921218126,590],[421.90148625957363,590],[411.9008688052668,590],[401.9011289769037,590],[391.8958328991971,590],[381.8923340561537,590],[371.90684841521715,590],[361.8989867337018,590],[351.89360795526,590],[341.8939334450056,590],[337.5999999999999,584.2938039422036],[337.59999999999985,574.2910183114145],[337.5999999999999,564.2981671345751],[337.5999999999999,554.3007912014291],[337.5999999999999,544.2982241511345],[337.5999999999999,534.3050642980263],[338.9987980160861,525.7],[349.00621349797575,525.7],[359.0014774032402,525.7],[366.1999999999999,522.9072702548001],[366.19999999999993,512.8939444104828],[366.19999999999993,502.9008824827208],[366.19999999999993,492.90056032079815],[366.19999999999993,482.90366032017414],[366.19999999999993,472.904765717849],[366.19999999999993,462.89526678621775],[366.1999999999999,452.89200689428327],[366.1999999999999,442.90209249908446],[366.19999999999993,432.9051476256747],[366.19999999999993,422.89610659219693],[366.19999999999993,412.90238961666836],[366.19999999999993,402.8948647260666],[362.8068941354751,396.3],[352.80020298822774,396.29999999999995],[342.79582543545393,396.3],[337.59999999999997,391.4895980834961],[337.5999999999999,381.49651602208615],[337.5999999999999,371.49868425582537],[337.5999999999999,361.49071865081794],[337.5999999999999,351.5021102905274],[337.5999999999999,341.50369540154935],[338.4058138750493,332.3],[348.39404854128355,332.3],[358.40857487544554,332.3],[368.40405027187666,332.3],[378.4035118492216,332.3],[388.4072745400794,332.3],[398.4030464189141,332.3],[408.3996339391638,332.30000000000007],[418.4009442223601,332.29999999999995],[428.40900970673147,332.3],[438.40671721061653,332.3],[448.3987175323068,332.3],[458.40092255811896,332.30000000000007],[468.3943710940889,332.3],[478.4077304808966,332.3],[488.4047026160056,332.3],[498.40672020962074,332.30000000000007],[508.4022476854602,332.3],[518.4038250505341,332.3],[528.3989609800046,332.30190591664285],[538.3987119788275,332.6564797049869],[548.336424500236,333.6535492588664],[558.1893080711365,335.3520882129669],[567.8851468566077,337.8237150600078],[577.3039889810606,341.14180097291245],[586.3563107497688,345.4072469301964],[594.845892301455,350.6882624535021],[602.5540168652572,357.0179859127253],[609.2915724665002,364.4132249905515],[614.8199833282123,372.7371747133395],[619.0146277945458,381.7955131960582],[621.864374465596,391.3700250098735],[623.4471092809019,401.2460819753338],[623.8983532965182,411.23148520588876],[623.4072780482944,421.2138485044432],[621.9415909050948,431.0978889329985],[619.3531906948075,440.7511234668201],[615.5197413307031,449.97254518306585],[610.3734099864959,458.53763022422794],[603.9592624629963,466.19447545647853],[596.4226713691668,472.7610076296782],[587.9941682067698,478.1411030084826],[578.9313059905253,482.33823205185854],[569.437343902794,485.4390963903934],[559.668201994321,487.5565301934621],[549.7503100685644,488.8039504580747],[539.7582091840421,489.2888484443896],[482.958984375,396.6],[479.7,403.33938243533487],[479.7,413.3331485275645],[479.7,423.3329074908048],[479.69999999999993,433.33806833662095],[479.7,443.3382473542821],[483.43722137361766,449.59999999999997],[493.4458886817796,449.45634642130466],[503.34819954189004,448.20594890924406],[512.4888081146404,444.33133747158575],[518.454194830358,436.48315754756334],[520.409131034161,426.705076083343],[520.0490171163983,416.73338943340497],[516.9411565393675,407.3008628305397],[509.8044489126187,400.45084557799856],[500.34180648927577,397.3647893522284],[490.3985127557535,396.60089570091804],],
  [[238.3,779.1973153591156],[238.3,769.1920759717934],[238.3,759.1904310048442],[238.3,749.1971078790724],[238.3,739.2068224244751],[238.3,729.202954107523],[237.0967807101086,720.4000000000001],[227.09751001205296,720.4000000000002],[217.103337941668,720.4000000000001],[209,722.2913538893686],[209,732.3031329235732],[209,742.3082132918994],[209,752.3009102576475],[209,762.3016338145595],[209,772.3093847435871],[209,782.2934725687142],[209,792.3025269720715],[209,802.3082433357836],[209,812.3028904590524],[209,822.3026507729287],[209,832.2982027773019],[209,842.3022354495974],[209,852.3043273925782],[218.9024759605527,852.4000000000001],[228.8967915290268,852.4000000000001],[238.90442668739706,852.4000000000001],[239.5,861.8014006600454],[239.5,871.8011324086955],[239.5,881.7979557167012],[239.5,891.7939324458829],[239.5,901.8069016236725],[239.5,911.8010413256677],[234.4013984247722,916.7],[224.39381373964534,916.7],[214.39949637617087,916.7],[204.3981829282597,916.7],[194.40092065808426,916.7],[184.39526710696714,916.7],[174.39573583876458,916.7],[164.39555078697435,916.7],[154.39241189956664,916.7],[144.39698532069474,916.7],[134.40092561435011,916.7],[124.39241858491151,916.7],[114.39036345403584,916.7],[104.3977762415172,916.7],[94.39845252429404,916.7],[84.39353090321238,916.7],[74.402097740745,916.7],[65.2,915.8974030784332],[65.2,905.9027427817812],[65.2,895.902321349585],[65.2,885.8910701390007],[65.2,875.8916803179426],[65.2,865.8985506556347],[65.2,855.900417868048],[71.60073988412042,852.3000000000001],[81.61021948249545,852.3],[91.61323997173459,852.3000000000001],[97.5,848.2047560691833],[97.5,838.2049718863097],[97.5,828.2043129278579],[97.5,818.1994593210082],[97.5,808.1968147297656],[97.5,798.2058675293491],[97.5,788.1971065704737],[97.5,778.1971222043037],[97.5,768.1883414383746],[97.5,758.1922039124446],[97.5,748.1929602191348],[97.5,738.2051002847264],[97.5,728.1863544686465],[95.38785871546715,720.3000000000001],[85.39845735824201,720.3000000000002],[75.39065832558553,720.3000000000001],[67.8,722.7002971301555],[67.8,732.7012324574201],[67.8,742.7040670933723],[67.8,752.7006580645074],[67.8,762.6951492592955],[67.8,772.6999286087928],[64.29993114329409,779.2],[54.30221481595653,779.2000000000002],[44.28535256422765,779.2],[34.29787555348594,779.2000000000002],[24.29848745673953,779.2],[14.301904868820564,779.2],[4.286823945702054,779.2],[0.5,772.9906373310835],[0.5,762.9892931699753],[0.5,752.988678690255],[0.5,742.9934189623448],[0.5,732.985404675873],[0.5,722.9932172423396],[0.5,712.9908159468032],[0.5,702.9903331637848],[0.5,693.002617809939],[0.5,682.9993428149319],[0.5,672.9942201191618],[0.5,662.9992691040039],[6.504179563373327,659],[16.496210553625133,659],[26.500972187561274,659],[36.51025880175439,659],[46.50592814013362,659],[56.50176406598621,659],[66.51030503661605,659],[76.50126641452516,659],[86.4966373895295,659],[96.5048939612825,659],[106.50434298859909,659],[116.51356375589967,659],[126.50764592125779,659],[136.50901596258063,659],[146.50358078608133,659],[156.5073997080326,659],[166.50964529439807,659],[176.51275537518086,659],[186.5033503151717,659],[196.50515986641312,659],[206.50811706022796,659],[216.50683202193522,659],[226.50857452256605,659],[236.51303172908956,659],[246.51470840489492,659],[256.4980468787253,659],[266.497900308168,659],[276.5131190926768,659],[286.5062395222485,659],[296.5055406491156,659],[304.5,661.0108629406895],[304.5,671.006217418213],[304.5,681.0115618083219],[304.5,691.014055462397],[304.5,700.9979290011863],[304.5,711.0005473519043],[304.5,721.0145191753872],[304.5,731.0026487112045],[304.5,741.0028134200722],[304.5,750.9994600556856],[304.5,761.0094981498551],[304.5,771.0090848763299],[302.6949769016355,779.2],[292.6838535905176,779.2000000000002],[282.6860759195406,779.2],[272.6846008579305,779.2],[262.69188837903204,779.2],[252.68481326534533,779.2],[242.69483490772546,779.2],],
  [[483.49283147426434,921.4999998549937],[473.5015928534664,921.2135999669564],[463.5430618249811,920.3393940706737],[453.6594031104208,918.8554149880631],[443.8883321941248,916.7404720808263],[434.2828071457334,913.978255006019],[424.88483199996546,910.5517263351032],[415.7619599521738,906.4560363595685],[406.98000032481195,901.6935826250037],[398.5819596745074,896.2595426388085],[390.64138067356544,890.1736876508803],[383.2342338752105,883.4741412087324],[376.3938021196342,876.1737100818433],[370.1974730706852,868.3456349906219],[364.66484797936226,860.0151950895104],[359.8373010399073,851.252426218346],[355.7416816057468,842.1365643193928],[352.3776375378808,832.7174472730713],[349.74544164991676,823.0714577493709],[347.8305427358516,813.265762352062],[346.60666497484635,803.3410411289005],[346.0459439160186,793.3499569720007],[346.10611895152687,783.3680548839533],[346.75056964396936,773.3742689786159],[348.00472862510935,763.4629613787508],[349.90274584133533,753.6442282521034],[352.46878452190776,743.9859570917924],[355.7283912288127,734.529959576347],[359.6890225112438,725.3554139733315],[364.36580538703146,716.5037406872052],[369.72939987875725,708.0802233735012],[375.7776650068028,700.1182148382217],[382.4726221525067,692.6877088313311],[389.76346025859766,685.8479509170672],[397.58755404142283,679.6464742000244],[405.91468145566705,674.0920003093004],[414.64693522165743,669.2273968725207],[423.7206976096137,665.0557765100955],[433.0947566502875,661.5644662381349],[442.6908156062132,658.7498092654816],[452.45386232280725,656.592292256563],[462.32961476483615,655.0681651824852],[472.2936219195035,654.1477263530687],[482.28119915948463,653.8040321857409],[492.27356902935645,654.0132356496681],[502.2586479106452,654.7955634845887],[512.1501505092469,656.1760494952382],[521.9524958675436,658.1880573922128],[531.5851814071001,660.8498834640784],[541.0077322676033,664.1834041315076],[550.1654855704771,668.2037652865031],[558.981639013812,672.9088755447417],[567.4052969406824,678.3003449570853],[575.3574573260274,684.3516681955305],[582.7866026892792,691.0406448729801],[589.6298261172888,698.3196318681883],[595.8506757768737,706.1494976858091],[601.4058639206166,714.4641037314024],[606.2712034031449,723.1987425862804],[610.4332434458302,732.2822798236048],[613.8979493243351,741.6632945703495],[616.6693568324197,751.2637123313623],[618.770312872665,761.0423475990457],[620.2217334624845,770.9321294944267],[621.0548081966275,780.9085796831992],[621.2984586761332,790.9067542492412],[620.939225759803,800.8954043474159],[619.9253177591484,810.8329952129279],[618.2200624753528,820.692817251764],[615.7999617953785,830.3926209951751],[612.6453633384817,839.8783867534066],[608.7479075296136,849.0845494853188],[604.1147757581303,857.9373991391985],[598.751286965108,866.3894433196051],[592.7152669347822,874.3373548470437],[586.0102611009215,881.7752667083541],[578.7281799237445,888.6104653601361],[570.9038945401945,894.8319094958089],[562.6036871935512,900.4091377547223],[553.900473266258,905.3212020038363],[544.8490605939497,909.5670209834063],[535.5044129648522,913.1493501050354],[525.9467354855232,916.06800084073],[516.2064896337213,918.3435597935846],[506.35032362117863,919.9887085911666],[496.4035067911658,921.0262979158933],[486.4155667197388,921.4761823002922],[498.024991160538,722.0940974579426],[489.8569849722087,716.5384518215433],[479.98866173187275,715.7475044877268],[471.24117236137386,720.2545871257782],[465.8387589514255,728.6098665297031],[463.4478378352593,738.2896184336976],[462.29517114817423,748.2282637383075],[461.64469351995933,758.199602275809],[461.2868699753307,768.1866282581235],[461.12749078235356,778.1903316491866],[461.0975824173074,788.1971987365862],[460.98016496444103,798.1899925937172],[460.81823855652476,808.1999076788895],[460.80985974975044,818.1937275811143],[461.21268624021315,828.1822452904177],[462.4408686153532,838.0917397899335],[465.2920006404805,847.6552864169659],[471.1828360965941,855.6234716069303],[480.3188797446491,859.369292352126],[490.23753901501476,858.7381486735234],[498.49514197467363,853.3586787062115],[503.2792846756085,844.647438796905],[505.60975563803515,834.9249080177208],[506.6233752044296,824.9976232161033],[506.92829464239475,814.9877607352464],[506.8644384431332,804.9927969469326],[506.67827340364454,794.9895239531994],[506.59918937021865,785.0068140928635],[506.53363736866737,774.9986779617495],[506.31985816955563,765.0074359893799],[505.8991945399902,755.0130074235611],[505.1651688401936,745.034710783686],[503.8521074823817,735.1280409416606]]
]
// prettier-ignore
const polylinesConstraints = [[0, 0], [639.5, 922]]
const mappedPolylines = polylines.map((line) => {
  return line.map((point) => {
    return [
      mapRange(point[0], polylinesConstraints[0][0], polylinesConstraints[1][0], 0, canvas.width),
      mapRange(point[1], polylinesConstraints[0][1], polylinesConstraints[1][1], 0, canvas.height),
    ];
  });
});
context.strokeStyle = "#000";
for (let letterIn = 0; letterIn < mappedPolylines.length; letterIn++) {
  context.beginPath();
  context.moveTo(...mappedPolylines[letterIn][0]);
  for (let i = 0; i < mappedPolylines[letterIn].length; i++) {
    context.lineTo(...mappedPolylines[letterIn][i]);
  }
  context.closePath();
  context.stroke();
}

class Hash {
  constructor({ context, angle, position, width }) {
    this.context = context;
    this.resetAngle = angle;
    this.position = position;
    this.width = width;
    this.isActive = false;
  }
}
class App {
  constructor() {
    // this.canvas = document.querySelector('canvas');
    // this.context = this.canvas.getContext('2d');

    this.windowWidth = window.innerWidth;
    this.windowHeight = window.innerHeight;

    this.step = this.windowWidth / 50;
    this.hashLength = this.windowWidth / 50;
    this.normalizedLines = mappedPolylines;
    this.hashes = [];

    this.isHovering = false;
    this.mousePos = {
      x: -200,
      y: -200,
    };
    this.mouseRadius = 200;
    this.canvases = [];

    this.canvasSetup();
    this.addListeners();
    this.render();
  }
  isInsidePolyLines(hash) {
    return this.normalizedLines.some((line) => {
      return inside(hash.position, line);
    });
  }
  isInsideMouse(hash) {
    return (
      Math.sqrt(
        Math.pow(hash.position[0] - this.mousePos.x, 2) +
          Math.pow(hash.position[1] - this.mousePos.y, 2)
      ) < this.mouseRadius
    );
  }
  canvasSetup() {
    this.windowWidth = window.innerWidth;
    this.windowHeight = window.innerHeight;

    canvas.width = this.windowWidth;
    canvas.height = this.windowHeight;
    context.globalCompositeOperation = "multiply";

    this.createGrid({ color: "hsl(315,81%,57%)" });
    this.createGrid({ color: "hsl(203,79%,61%)", offset: [4, 0] });
    this.createGrid({
      color: "hsl(50,95%,64%)",
      offset: [0, 4],
      angle: 45,
    });
  }
  addListeners() {
    document.addEventListener("mousemove", (e) => {
      const offsetX = e.clientX - rect.left;
      const offsetY = e.clientY - rect.top;

      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;

      this.mousePos.x = offsetX * scaleX;
      this.mousePos.y = offsetY * scaleY;
    });
  }
  drawHash(hash) {
    const { hashLength } = this;

    hash.context.save();
    hash.context.translate(hash.position[0] + hashLength / 2, hash.position[1] + hashLength / 2);
    hash.context.rotate(hash.resetAngle);
    hash.context.translate(-hashLength / 2, -hashLength / 2);
    hash.context.beginPath();
    hash.context.moveTo(0, 0);
    hash.context.lineTo(hashLength, 0);
    hash.context.lineWidth = hash.width;
    hash.context.stroke();
    hash.context.restore();

    const speed = 8;
    if (hash.width < this.windowWidth / 50 && hash.isActive) {
      hash.width += speed;
    } else if (hash.width > 2 && !hash.isActive) {
      hash.width -= speed;
    }
  }
  createGrid({ color, offset, angle }) {
    const { step } = this;
    const { width, height } = canvas;
    if (offset === undefined) offset = [0, 0];
    if (angle === undefined) angle = -45;

    let precanvas = document.createElement("canvas");
    precanvas.width = canvas.width;
    precanvas.height = canvas.height;
    this.canvases.push(precanvas);
    let precontext = precanvas.getContext("2d");
    precontext.strokeStyle = color;

    for (let y = 0; y < height; y += step) {
      for (let x = 0; x < width; x += step) {
        const hash = new Hash({
          position: [x + offset[0], y + offset[1]],
          angle: degreesToRadians(angle),
          context: precontext,
          width: 2,
        });
        this.hashes.push(hash);
      }
    }
    this.normalizedLines = mappedPolylines;
  }

  render() {
    this.canvases.forEach((precan) => {
        let cont = precan.getContext("2d");
        cont.clearRect(0, 0, precan.width, precan.height);
    });
    requestAnimationFrame(this.render.bind(this));

    if (frame > 8) {
      if (window.pageYOffset > startOffset + rect.bottom + 300) {
        return;
      }

      if (this.mousePos.x === lastMousePos.x && this.mousePos.y === lastMousePos.y) {
        return;
      }

      frame = 0;
    }

    lastMousePos = { ...this.mousePos };

    context.clearRect(0, 0, canvas.width, canvas.height);
    this.hashes.forEach((hash) => {
      if (this.isInsideMouse(hash) && this.isInsidePolyLines(hash)) {
        hash.isActive = false;
      } else if (this.isInsidePolyLines(hash)) {
        hash.isActive = true;
      } else if (this.isInsideMouse(hash)) {
        hash.isActive = true;
      } else {
        hash.isActive = false;
      }
      this.drawHash(hash);
    });

    this.canvases.forEach(canvas => {
        context.drawImage(canvas, 0, 0, canvas.width, canvas.height);
    });

    frame++;

  }
}
const app = new App();
